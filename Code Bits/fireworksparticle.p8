pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
 ps={}
 g=0.02
 max_vel=2
 min_time=2
 max_time=5
 min_life=90
 max_life=120
 t=0
 cols={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}
 burst=5

 next_p=rndb(min_time,max_time)
end

function rndb(low,high)
 return flr(rnd(high-low+1)+low)
end


function _update()
-- t+=1
-- if (t==next_p) then
--  add_p(64,64)
--  next_p=rndb(min_time,max_time)
--  t=0
-- end

 --burst
 if btnp(4) or btnp(5) then
  sfx(1)
  for i=1, burst do
   add_p(64,64)
   end
 end
 foreach(ps,update_p) 
end

function _draw()
 cls()
 --print("col: "..#cols)
 foreach(ps,draw_p)
end

function add_p(x,y)
 local p={}
 p.x,p.y=x,y
 p.dx=rnd(max_vel)-max_vel/2
 p.dy=rnd(max_vel)*-1
 p.life_start=rndb(min_life,max_life)
 p.life=p.life_start
 add(ps,p)
end

function update_p(p)
 if (p.life<=0) then
  del(ps,p)
 else
  p.dy+=g
  if ((p.y+p.dy)>127) p.dy*=-0.8
  p.x+=p.dx --update position
  p.y+=p.dy
  p.life-=1
 end
end

function draw_p(p)
 local pcol=flr(p.life/p.life_start*#cols+1)
 print("pcol: "..pcol)
 pset(p.x,p.y,cols[pcol])
end



__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000600003d6703b6703a6703966037660366603466032650306502f6502d6402a640286302663023630226301f6301b620186201662014620126200f6200b6100a61007610056100361002600006000060000000
010400002f6702f6702f6702f6702e6702e6702e6602e6602e6602e6602e6502e6502e6502e6502e6402e6402e6302e6302e6302e6202e6202e6202e6202e6102e6102e6102e6002e6002e6002e6002e6002f600
